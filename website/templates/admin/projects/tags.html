{% from 'macros.html' import flash %}
{{ flash() }}
<script>
	function rename_tag(button) {
		var tag = $(button).parent().parent().siblings().eq(0);
		var oldtag = tag.text();
		var newtag = prompt("New name for tag", oldtag);
		if(newtag == null || newtag == oldtag)
			return;
		$.post('{{ url_for("project_tags") }}',
			{ tag: oldtag, action: "rename", newtag: newtag},
			function (data) {
				if (data.result == 'success') {
					tag.text(newtag);
					flash("Tag '" + oldtag + "' renamed to '" + newtag + "'", "success");
				} else {
					flash("Tag '" + oldtag + "' could not be renamed to '" + newtag + "'\n:"+data.result, "danger");
				}
			});
	}
	function delete_tag(button) {
		var tag = $(button).parent().parent().siblings().eq(0);
		var oldtag = tag.text();
		if (confirm("Delete tag '" + oldtag + "'?")) {
			$.post('{{ url_for("project_tags") }}',
				{ tag: oldtag, action: "delete" },
				function (data) {
					if (data.result == 'success') {
						tag.parent().remove();
						flash("Tag '" + oldtag + "' deleted", "success");
					} else {
						flash("Tag '" + oldtag + "' could not be deleted\n:" + data.result, "danger");
					}
				});
		}
	}
</script>
<table class="table table-hover">
	<thead>
		<tr><th>Tag</th><th>Number of Projects</th><th>Controls</th></tr>
	</thead>
	<tbody>
		{% for tag in content.data.tags %}
		<tr>
			<td id="tag">{{ tag.tag }}</td>
			<td>{% if tag.count %}{{ tag.count }}{% else %}0{% endif %}</td>
			<td>
				<div class="btn-group">
					<a target="_blank" class="btn btn-success" href="{{ url_for('projects', tag=tag.tag) }}" title="View Projects with Tag">
						<span class="glyphicon glyphicon-play" aria-hidden="true"></span>
						<span class="sr-only">View Projects with Tag</span>
					</a>
					<button type="button" class="btn btn-info" title="Rename Tag" onclick="rename_tag(this);">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
						<span class="sr-only">Rename Tag</span>
					</button>
					<button type="button" class="btn btn-danger" title="Delete Tag" onclick="delete_tag(this);">
						<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
						<span class="sr-only">Delete Tag</span>
					</button>
				</div>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<form name="create" id="create" class="panel" action="{{ url_for('project_tags') }}" method="post">
	<div class="input-group">
		<span class="input-group-addon">Create a new Tag:</span>
		<input type="text" name="newtag" id="newtag" required class="form-control" placeholder="New Tag" />
		<span class="input-group-btn"><button type="submit" class="btn btn-info">Create</button></span>
	</div>
</form>