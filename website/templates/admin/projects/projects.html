{% from 'macros.html' import flash %}
{{ flash() }}
<script>
	function move_project(button) {
		var proj = $(button).parent().parent().parent();
		var jpath = proj.find("#path");
		var path = jpath.text();
		var title = proj.find("#title").text();
		var newpath = prompt("New path for project", path);
		if (newpath == null)
			return;
		$.post('{{ url_for("projects_edit") }}',
			{ path: path, action: "move", target: newpath },
			function (data) {
				if (data.result == 'success') {
					jpath.text(newpath);
					proj.find("a[href]").attr("href", function () {
						return this.href.substring(0, this.href.length - path - 2) + this.href.substring(this.href.length - path - 2, this.href.length).replace(path, newpath);
					});
					flash("Project '" + title + "' at '" + path + "' moved to '" + newpath + "'", "success");
				} else {
					flash("Project '" + title + "' at '" + path + "' could not be moved to '" + newpath + "':\n" + data.result, "danger");
				}
			});
	}
	function delete_project(button) {
		var proj = $(button).parent().parent().parent();
		var path = proj.find("#path").text();
		var title = proj.find("#title").text();
		if (confirm("Delete project '"+title+"' at '" + path + "'?")) {
			$.post('{{ url_for("projects_edit") }}',
				{ path: path, action: "delete" },
				function (data) {
					if (data.result == 'success') {
						proj.remove();
						flash("Project '"+title+"' at '" + path + "' deleted", "success");
					} else {
						flash("Project '" + title + "' at '" + path + "' could not be deleted:\n" + data.result, "danger");
					}
				});
		}
	}
</script>
<table class="table table-hover">
	<thead>
		<tr>
			<th>Project</th>
			<th>Path</th>
			<th>Featured</th>
			<th>Tools</th>
		</tr>
	</thead>
	<tbody>
		{% for project in content.data.projects %}
		<tr>
			<td id="title">{{ project.title }}</td>
			<td>/projects/<span id="path">{{ project.path }}</span>/</td>
			<td>
				<button class="btn btn-default">
					{% if project.featured %}
					<span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span><span class="sr-only">Featured</span>
					{% else %}<span class="glyphicon glyphicon-bullhorn glyphicon-none"></span>{% endif %}
				</button>
			</td>
			<td>
				<div class="btn-group">
					<a target="_blank" class="btn btn-success" href="{{ url_for('project', project=project.path) }}" title="View Project Page">
						<span class="glyphicon glyphicon-play" aria-hidden="true"></span>
						<span class="sr-only">View</span>
					</a>
					<a target="_blank" href="{{ url_for('projects_edit', path=project.path) }}" class="btn btn-info" title="Edit Project">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
						<span class="sr-only">Edit</span>
					</a>
					<button type="button" class="btn btn-warning" title="Move Project" onclick="move_project(this);">
						<span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
						<span class="sr-only">Move</span>
					</button>
					<button type="button" class="btn btn-danger" title="Delete Project" onclick="delete_project(this);">
						<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
						<span class="sr-only">Delete</span>
					</button>
				</div>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
{% include 'admin/projects/create.html' %}