{% from 'macros.html' import flash %}
{{ flash() }}
<script>
	function move_project(button) {
		var proj = $(button).parent().parent().parent();
		var jpath = proj.find("#path");
		var path = jpath.text();
		var title = proj.find("#title").text();
		var url = proj.find("#edit").attr("href");
		var newpath = prompt("New path for project", path);
		if (newpath == null)
			return;
		$.post(url,
			{ action: "move", target: newpath },
			function (result) {
				if (result == 'success') {
					jpath.text(newpath);
					proj.find("a[href]").attr("href", function () {
						return this.href.substring(0, this.href.length - path - 2) + this.href.substring(this.href.length - path - 2, this.href.length).replace(path, newpath);
					});
					flash("Project '" + title + "' at '" + path + "' moved to '" + newpath + "'", "success");
				} else {
					flash("Project '" + title + "' at '" + path + "' could not be moved to '" + newpath + "':\n" + result, "danger");
				}
			});
	}
	function delete_project(button) {
		var proj = $(button).parent().parent().parent();
		var path = proj.find("#path").text();
		var title = proj.find("#title").text();
		var url = proj.find("#edit").attr("href");
		if (confirm("Delete project '"+title+"' at '" + path + "'?")) {
			$.post(url,
				{ action: "delete" },
				function (result) {
					if (result == 'success') {
						proj.remove();
						flash("Project '"+title+"' at '" + path + "' deleted", "success");
					} else {
						flash("Project '" + title + "' at '" + path + "' could not be deleted:\n" + result, "danger");
					}
				});
		}
	}
	function toggle_featured(button) {
	}
</script>
<table class="table table-hover">
	<thead>
		<tr>
			<th>Project</th>
			<th>Path</th>
			<th>Featured</th>
			<th>Tools</th>
		</tr>
	</thead>
	<tbody>
		{% for project in content.data.projects %}
		<tr>
			<td id="title">{{ project.title }}</td>
			<td id="path">{{ project.path }}</td>
			<td>				
				{% if project.featured %}
				<button class="btn btn-default" onclick="toggle_featured(this);" title="Featured (Priority: {{ project.priority }})">
					<span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span><span class="sr-only">Featured</span>
				</button>
				{% else %}
				<button class="btn btn-default" onclick="toggle_featured(this);" title="Not Featured">
					<span class="glyphicon glyphicon-bullhorn glyphicon-none"></span>
				</button>
				{% endif %}
			</td>
			<td>
				<div class="btn-group">
					<a target="_blank" class="btn btn-success" href="{{ url_for('project', project=project.path) }}" title="View Project Page" id="view">
						<span class="glyphicon glyphicon-play" aria-hidden="true"></span>
						<span class="sr-only">View</span>
					</a>
					<a target="_blank" href="{{ url_for('projects_edit', project=project.path) }}" class="btn btn-info" title="Edit Project" id="edit">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
						<span class="sr-only">Edit</span>
					</a>
					<button type="button" class="btn btn-warning" title="Move Project" onclick="move_project(this);">
						<span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
						<span class="sr-only">Move</span>
					</button>
					<button type="button" class="btn btn-danger" title="Delete Project" onclick="delete_project(this);">
						<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
						<span class="sr-only">Delete</span>
					</button>
				</div>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
</div><div class="panel">
{% include 'admin/projects/create.html' %}