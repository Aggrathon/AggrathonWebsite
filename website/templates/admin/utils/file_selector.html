<div class="modal fade" id="file_selector" onload="$('body').append($(this));">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">Select File</h4>
			</div>
			<div class="modal-body" style="padding:0.2em;">
				<iframe id="file_selector_iframe" style="width:100%;"></iframe>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" onclick="file_selector_save('');" data-dismiss="modal">Empty</button>
				<button type="button" class="btn btn-info" onclick="file_selector_external();" data-dismiss="modal">External URL</button>
				<button type="button" class="btn btn-success" onclick="file_selector_save();" data-dismiss="modal">Select</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	var file_selector_callback;
	function file_selector(callback, images) {
		var modal = $('#file_selector');
		var iframe = modal.find('#file_selector_iframe')
		if (images) {
			modal.find('.modal-header h4').html('Select Image');
			iframe.attr('src', "{{ url_for('files_embed', filter='png,jpg,jpeg,gif') }}");
		} else {
			modal.find('.modal-header h4').html('Select File');
			iframe.attr('src', "{{ url_for('files_embed') }}");
		}
		modal.modal('show');
		file_selector_callback = callback;
	}
	function file_selector_save(path) {
		if (path == undefined)
			path = $('#file_selector #file_selector_iframe').contents().find('#files_selected_path').val()
		file_selector_callback(path);
	}
	function file_selector_external() {
		var url = prompt('External url:', 'http://');
		if (url) {
			file_selector_save(url);
		}
	}
	$('#file_selector_iframe').load( function() {setTimeout(function() {
		var iframe = $('#file_selector_iframe');
		iframe.height(iframe.contents().height());
	}, 200) });
</script>