{% from 'macros.html' import flash %}
{{ flash() }}
<form method="post" id="contact" name="contact">
	<div class="form-group">
		<label for="email" class="control-label">Email address *</label>
		<input type="email" class="form-control" id="email" placeholder="Email" name="email" {% if content.data.email %}value="{{ content.data.email }}"{% endif %} />
	</div>
	<div class="form-group hidden">
		<label for="website" class="control-label">Website</label>
		<input type="url" class="form-control" id="website" placeholder="Leave this empty (This field finds bots)" name="website" />
	</div>
	<div class="form-group">
		<label for="subject" class="control-label">Subject *</label>
		<input type="text" class="form-control" id="subject" placeholder="Subject" name="subject" {% if content.data.subject %}value="{{ content.data.subject }}" {% endif %} />
	</div>
	<div class="form-group">
		<label for="message" class="control-label">Message *</label>
		<textarea class="form-control" id="message" placeholder="Message" name="message"> {% if content.data.message %}{{ content.data.message }}{% endif %}</textarea>
	</div>
	<div class="panel">Insert Captcha here</div>
	<button class="btn btn-primary btn-lg" type="submit" id="submitButton" disabled="disabled" onclick="submitButton(this);">Send Message</button>
	<span class="pull-right">* Required</span>
	<script language="JavaScript" type="text/javascript">
		function submitTimer(left) {
			button = $('button#submitButton');
			if (left < 0) {
				button.attr("disabled", false);
				button.html("Send Message");
			} else {
				button.html("Wait: " + left)
				button.attr("disabled", true);
				left = left -1
				setTimeout(function () { submitTimer(left); }, 1000);
			}
		}
		submitTimer(5);
		function submitButton(button) {
			if (!button.disabled) {
				var complete = true;
				var subject = $('#subject');
				if (subject.val() == '') {
					complete = false;
					subject.parent().addClass('has-error');
					subject.parent().removeClass('has-success');
				} else {
					subject.parent().addClass('has-success');
					subject.parent().removeClass('has-error');
				}
				var message = $('#message');
				if (message.val() == '') {
					complete = false;
					message.parent().addClass('has-error');
					message.parent().removeClass('has-success');
				} else {
					message.parent().addClass('has-success');
					message.parent().removeClass('has-error');
				}
				var email = $('#email');
				var emailval = ""+email.val();
				if (emailval != '' && emailval.split('@').length == 2 && emailval.split('@')[1].split('.') > 1) {
					email.parent().addClass('has-success');
					email.parent().removeClass('has-error');
				} else {
					complete = false;
					email.parent().addClass('has-error');
					email.parent().removeClass('has-success');
				}
				if (complete) {
					return true;
				} else {
					flash('All required fields not filled correctly', 'danger');
					submitTimer(3);
					return false;
				}
			}
		}
		{% if content.data.check %}submitButton({disabled:false});{% endif %}
	</script>
</form>