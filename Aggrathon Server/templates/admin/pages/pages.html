{#
	This page shows a list of all pages with quick access to some commands
#}
{% from 'admin/pages/macros.html' import toolbar, ajax_functions %}
{{ ajax_functions(true) }}
<script>
	function getRow(path) {
		return $("tr[id='page_" + path + "']");
	}
	function deleteSuccess(path) {
		getRow(path).remove();
	}
	function moveSuccess(oldpath, newpath) {
		getRow(oldpath).find('#path').html(newpath);
	}
	function copySuccess(oldpath, newpath) {
		var parent = getRow(oldpath);
		var clone = parent[0].outerHTML;
		clone = clone.replace("'" + oldpath + "'", "'" + newpath + "'");
		clone = clone.replace(">" + oldpath + "<", ">" + newpath + "<");
		clone = clone.replace("=" + oldpath + '"', "=" + newpath + '"');
		parent.after(clone);
		getRow(newpath).find('#featured').html('');
	}
	function createPage() {
		var path = promptNewPath("New path for the page (must begin with '/pages/')", '/pages/')
		$.post('/admin/pages/edit/',
			{ page: path, action: "create" },
			function (data) {
				if (data.result == 'success') {
					flash("Page at '" + path + "' created", "success");
					window.location.href = '/admin/pages/edit/?page=' + path;
				} else {
					flash("Page at '" + path + "' could not be created:\n" + status, "danger");
				}
			});
	}
</script>
<table class="table table-hover">
	<thead>
		<tr>
			<th>Page</th>
			<th>Path</th>
			<th>Featured</th>
			<th>Tools</th>
		</tr>
	</thead>
	<tbody>
		{% for page in content.data.pages %}
		<tr id="page_{{ page.url }}">
			<td>{% if page.url == '/' and page.title == '' %}Main Page{% endif %}{{ page.title }}</td>
			<td id="path">{{ page.url }}</td>
			<td id="featured">{% if page.featured %}<span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="sr-only">Featured</span>{% endif %}</td>
			<td>{{ toolbar(page.url) }}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
<br />
<div>
	<button class="btn btn-primary" onclick="createPage();">Create a new Page</button>
</div>